# Bitbucket Pipelines configuration for {{PROJECT_NAME}}
# Generated by xcboot - https://github.com/nickhart/xcboot
#
# ⚠️  EXPERIMENTAL SUPPORT
# This is a basic Bitbucket Pipelines configuration. Contributions welcome!
# For full support, consider using GitHub Actions.

image: atlassian/default-image:3

pipelines:
  default:
    - step:
        name: Preflight Check
        image: macos-13-xcode-15
        script:
          # Install Homebrew dependencies
          - brew bundle install --file=./Brewfile
          # Generate Xcode project
          - xcodegen generate
          # Run preflight checks
          - ./scripts/preflight.sh
        artifacts:
          - test-results/**

  branches:
    main:
      - step:
          name: Build & Test
          image: macos-13-xcode-15
          script:
            - brew bundle install --file=./Brewfile
            - xcodegen generate
            - ./scripts/build.sh
            - ./scripts/test.sh --all
          artifacts:
            - test-results/**

  pull-requests:
    '**':
      - step:
          name: PR Quality Check
          image: macos-13-xcode-15
          script:
            - brew bundle install --file=./Brewfile
            - xcodegen generate
            - ./scripts/format.sh
            - ./scripts/lint.sh
            - ./scripts/build.sh
            - ./scripts/test.sh

definitions:
  caches:
    cocoapods: ~/Library/Caches/CocoaPods
    carthage: ~/Library/Caches/org.carthage.CarthageKit
    homebrew: ~/Library/Caches/Homebrew
