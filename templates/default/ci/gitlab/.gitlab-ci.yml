# GitLab CI configuration for {{PROJECT_NAME}}
# Generated by xcboot - https://github.com/nickhart/xcboot
#
# ⚠️  EXPERIMENTAL SUPPORT
# This is a basic GitLab CI configuration. Contributions welcome!
# For full support, consider using GitHub Actions.

image: macos-13-xcode-15

stages:
  - test

variables:
  DEVELOPER_DIR: "/Applications/Xcode.app/Contents/Developer"

before_script:
  # Install Homebrew dependencies
  - brew bundle install --file=./Brewfile
  # Generate Xcode project
  - xcodegen generate

preflight:
  stage: test
  script:
    - ./scripts/preflight.sh
  artifacts:
    reports:
      junit: test-results/*.xml
    paths:
      - test-results/
    when: always
  tags:
    - macos
    - xcode

# Optional: Separate jobs for each check
lint:
  stage: test
  script:
    - ./scripts/lint.sh
  allow_failure: false
  tags:
    - macos

format-check:
  stage: test
  script:
    - ./scripts/format.sh
  allow_failure: false
  tags:
    - macos

build:
  stage: test
  script:
    - ./scripts/build.sh
  allow_failure: false
  tags:
    - macos
    - xcode

test:
  stage: test
  script:
    - ./scripts/test.sh --all
  allow_failure: false
  tags:
    - macos
    - xcode
